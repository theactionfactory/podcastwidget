<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Podcast Widget</title>
  <style>
    :root {
      /* Light, clean palette similar to your reference */
      --bg: #f9fafb;
      --card-bg: #ffffff;
      --border-subtle: #e5e7eb;
      --accent: #d4a214;             /* warm gold, tweak if you like */
      --accent-soft: rgba(212,162,20,0.15);
      --text: #111827;
      --muted: #6b7280;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .app {
      min-height: 100vh;
      background: var(--bg);
    }

    .wrapper {
      max-width: 960px;
      margin: 0 auto;
      padding: 2.5rem 1.5rem 3rem;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1.75rem;
    }

    .section-title {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .section-subtitle {
      margin: 0.25rem 0 0;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .section-meta {
      font-size: 0.85rem;
      color: var(--muted);
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.25rem;
      white-space: nowrap;
    }

    .see-all-label {
      color: var(--accent);
      font-weight: 500;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-size: 0.75rem;
    }

    .episodes {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .episode {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 1.25rem;
      padding: 1.1rem 0;
      border-top: 1px solid var(--border-subtle);
    }

    .episode:first-of-type {
      border-top: none;
    }

    .thumb {
      border-radius: 12px;
      overflow: hidden;
      background: #e5e7eb;
    }

    .thumb img {
      width: 100%;
      height: 100%;
      max-height: 160px;
      object-fit: cover;
      display: block;
    }

    .episode-body {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .episode-title {
      font-size: 1rem;
      font-weight: 600;
      margin: 0 0 0.25rem;
    }

    .episode-meta {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 0.4rem;
    }

    .episode-description {
      font-size: 0.9rem;
      color: #374151;
      margin: 0.2rem 0 0.4rem;
    }

    .toggle-btn {
      color: var(--accent);
      cursor: pointer;
      font-size: 0.82rem;
      margin-left: 0.15rem;
    }

    .episode-footer {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
    }

    audio {
      width: 100%;
    }

    .status,
    .error {
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: 1.25rem;
    }

    .error {
      color: #b91c1c;
    }

    @media (max-width: 768px) {
      .section-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .section-meta {
        align-items: flex-start;
      }

      .episode {
        grid-template-columns: 1fr;
      }

      .thumb img {
        max-height: 220px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="wrapper">
      <header class="section-header">
        <div>
          <h1 class="section-title" id="feedTitle">Latest podcast episodes</h1>
          <p class="section-subtitle" id="feedSubtitle">
            Listen to the newest conversations, updated automatically from the podcast feed.
          </p>
        </div>
        <div class="section-meta">
          <span class="see-all-label">New episodes as they drop</span>
          <span class="badge" id="episodeCount">Loading…</span>
        </div>
      </header>

      <main>
        <div id="episodes" class="episodes"></div>
        <div id="status" class="status">Loading episodes…</div>
        <div id="error" class="error" style="display:none;"></div>
      </main>
    </div>
  </div>

  <script>
    const FEED_URL = "https://anchor.fm/s/109ccf36c/podcast/rss";
    const API_URL = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(FEED_URL);

    const episodesContainer = document.getElementById("episodes");
    const statusEl = document.getElementById("status");
    const errorEl = document.getElementById("error");
    const titleEl = document.getElementById("feedTitle");
    const subtitleEl = document.getElementById("feedSubtitle");
    const countEl = document.getElementById("episodeCount");

    function stripHtml(html) {
      const tmp = document.createElement("div");
      tmp.innerHTML = html || "";
      return (tmp.textContent || tmp.innerText || "").trim();
    }

    function formatDate(dateString) {
      const d = new Date(dateString);
      if (isNaN(d)) return "";
      return d.toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric",
      });
    }

    function renderEpisodes(feedData) {
      const items = feedData.items || [];
      episodesContainer.innerHTML = "";

      if (!items.length) {
        statusEl.textContent = "No episodes available yet.";
        return;
      }

      // Header info
      if (feedData.feed) {
        if (feedData.feed.title) {
          titleEl.textContent = feedData.feed.title;
        }
        if (feedData.feed.description) {
          const desc = stripHtml(feedData.feed.description);
          if (desc) {
            subtitleEl.textContent = desc;
          }
        }
      }

      countEl.textContent = items.length + " episodes";
      statusEl.textContent = "";

      items.forEach((item) => {
        const episodeEl = document.createElement("article");
        episodeEl.className = "episode";

        const thumbUrl =
          item.thumbnail ||
          (feedData.feed && (feedData.feed.image || feedData.feed.itunes_image)) ||
          "";

        const fullDesc = stripHtml(item.description || item.content || "");
        const hasLongDesc = fullDesc.length > 220;
        const shortDesc = hasLongDesc ? fullDesc.slice(0, 200) + "..." : fullDesc;

        const audioSrc =
          (item.enclosure && (item.enclosure.link || item.enclosure.url)) || "";

        episodeEl.innerHTML = `
          <div class="thumb">
            ${thumbUrl ? `<img src="${thumbUrl}" alt="Episode artwork" loading="lazy" />` : ""}
          </div>
          <div class="episode-body">
            <h2 class="episode-title">${item.title || "Untitled episode"}</h2>
            <div class="episode-meta">
              ${formatDate(item.pubDate)}${item.itunes_duration ? " • " + item.itunes_duration : ""}
            </div>
            <p class="episode-description">
              <span class="short-text">${shortDesc}</span>
              <span class="full-text" style="display:${hasLongDesc ? "none" : "inline"};">${hasLongDesc ? fullDesc : ""}</span>
              ${hasLongDesc ? `<span class="toggle-btn">Read more</span>` : ""}
            </p>
            <div class="episode-footer">
              ${audioSrc ? `<audio controls preload="none" src="${audioSrc}"></audio>` : ""}
            </div>
          </div>
        `;

        // Add Read more / Read less toggle if needed
        if (hasLongDesc) {
          const toggleBtn = episodeEl.querySelector(".toggle-btn");
          const shortText = episodeEl.querySelector(".short-text");
          const fullText = episodeEl.querySelector(".full-text");

          toggleBtn.addEventListener("click", () => {
            const expanded = fullText.style.display !== "none";
            if (expanded) {
              fullText.style.display = "none";
              shortText.style.display = "inline";
              toggleBtn.textContent = "Read more";
            } else {
              fullText.style.display = "inline";
              shortText.style.display = "none";
              toggleBtn.textContent = "Read less";
            }
          });
        }

        episodesContainer.appendChild(episodeEl);
      });
    }

    async function loadFeed() {
      try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error("Network error " + res.status);
        const data = await res.json();
        if (data.status !== "ok") throw new Error(data.message || "Feed error");
        renderEpisodes(data);
      } catch (err) {
        console.error(err);
        statusEl.textContent = "";
        errorEl.style.display = "block";
        errorEl.textContent = "Sorry, we couldn't load the podcast feed.";
      }
    }

    loadFeed();
  </script>
</body>
</html>

